generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model clients {
  id                               BigInt                             @id @default(autoincrement())
  name                             String                             @db.VarChar(150)
  document_id                      String?                            @unique(map: "unique_document_id") @db.VarChar(50)
  email                            String                             @unique(map: "unique_email") @db.VarChar(150)
  phone                            String                             @db.VarChar(30)
  address                          String                             @db.VarChar(255)
  country                          String                             @db.VarChar(80)
  plan                             String                             @db.VarChar(50)
  status                           String                             @db.VarChar(20)
  created_at                       DateTime?                          @default(now()) @db.Timestamp(6)
  updated_at                       DateTime?                          @default(now()) @db.Timestamp(6)
  password_hash                    String
  inventory_finished_products      inventory_finished_products[]
  inventory_raw_material_movements inventory_raw_material_movements[]
  inventory_raw_materials          inventory_raw_materials[]
  productions                      productions[]
  products                         products[]
  raw_materials                    raw_materials[]
  suppliers                        suppliers[]
}

model inventory_finished_products {
  id         BigInt    @id(map: "product_inventory_pkey") @default(autoincrement())
  client_id  BigInt
  product_id BigInt
  quantity   Decimal   @db.Decimal(10, 2)
  unit       String    @db.VarChar(20)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
  clients    clients   @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "product_inventory_client_id_fkey")
  products   products  @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "product_inventory_product_id_fkey")
}

model production_materials {
  id              BigInt        @id @default(autoincrement())
  production_id   BigInt
  raw_material_id BigInt
  quantity        Decimal       @db.Decimal(10, 2)
  unit            String        @db.VarChar(20)
  created_at      DateTime?     @default(now()) @db.Timestamp(6)
  productions     productions   @relation(fields: [production_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  raw_materials   raw_materials @relation(fields: [raw_material_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model production_products {
  id            BigInt      @id @default(autoincrement())
  production_id BigInt
  product_id    BigInt
  quantity      Decimal     @db.Decimal(10, 2)
  unit          String      @db.VarChar(20)
  created_at    DateTime?   @default(now()) @db.Timestamp(6)
  products      products    @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  productions   productions @relation(fields: [production_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model productions {
  id                   BigInt                 @id @default(autoincrement())
  client_id            BigInt
  production_date      DateTime               @db.Date
  batch_code           String?                @db.VarChar(100)
  notes                String?
  status               String                 @db.VarChar(20)
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  updated_at           DateTime?              @default(now()) @db.Timestamp(6)
  production_materials production_materials[]
  production_products  production_products[]
  clients              clients                @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model products {
  id                          BigInt                        @id @default(autoincrement())
  client_id                   BigInt
  name                        String                        @db.VarChar(150)
  category                    String                        @db.VarChar(100)
  unit                        String                        @db.VarChar(20)
  default_yield               Decimal?                      @db.Decimal(10, 2)
  description                 String?
  status                      String                        @db.VarChar(20)
  image_url                   String?
  created_at                  DateTime?                     @default(now()) @db.Timestamp(6)
  updated_at                  DateTime?                     @default(now()) @db.Timestamp(6)
  inventory_finished_products inventory_finished_products[]
  production_products         production_products[]
  clients                     clients                       @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model raw_materials {
  id                               BigInt                             @id @default(autoincrement())
  client_id                        BigInt
  supplier_id                      BigInt?
  name                             String                             @db.VarChar(150)
  unit                             String                             @db.VarChar(20)
  cost_per_unit                    Decimal?                           @db.Decimal(10, 2)
  description                      String?
  status                           String                             @db.VarChar(20)
  created_at                       DateTime?                          @default(now()) @db.Timestamp(6)
  updated_at                       DateTime?                          @default(now()) @db.Timestamp(6)
  inventory_raw_material_movements inventory_raw_material_movements[]
  inventory_raw_materials          inventory_raw_materials[]
  production_materials             production_materials[]
  clients                          clients                            @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  suppliers                        suppliers?                         @relation(fields: [supplier_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model suppliers {
  id            BigInt          @id(map: "providers_pkey") @default(autoincrement())
  client_id     BigInt?
  name          String          @db.VarChar(150)
  contact_name  String?         @db.VarChar(150)
  phone         String          @db.VarChar(30)
  email         String          @db.VarChar(150)
  address       String          @db.VarChar(255)
  document_id   String          @db.VarChar(50)
  notes         String?
  status        String          @db.VarChar(20)
  created_at    DateTime?       @default(now()) @db.Timestamp(6)
  updated_at    DateTime?       @default(now()) @db.Timestamp(6)
  raw_materials raw_materials[]
  clients       clients?        @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "providers_client_id_fkey")
}

model inventory_raw_materials {
  id              BigInt        @id @default(autoincrement())
  client_id       BigInt
  raw_material_id BigInt
  quantity        Decimal       @db.Decimal(10, 2)
  unit            String        @db.VarChar(20)
  updated_at      DateTime?     @default(now()) @db.Timestamp(6)
  clients         clients       @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  raw_materials   raw_materials @relation(fields: [raw_material_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model inventory_raw_material_movements {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id       BigInt
  raw_material_id BigInt
  type            String        @db.VarChar(20)
  quantity        Decimal       @db.Decimal(10, 2)
  unit            String        @db.VarChar(20)
  reference_id    String?       @db.Uuid
  notes           String?
  created_at      DateTime?     @default(now()) @db.Timestamp(6)
  clients         clients       @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  raw_materials   raw_materials @relation(fields: [raw_material_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
